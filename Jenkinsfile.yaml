pipeline:
  agent:
    label: "docker"   # any node with Docker installed

  environment:
    DOCKER_IMAGE: "yourdockerhubusername/yourimagename"
    TAG: "latest"

  stages:
    - stage: Checkout
      steps:
        - checkout: git

    - stage: Build Docker Image
      steps:
        - sh: |
            echo "Building Docker image..."
            docker build -t ${DOCKER_IMAGE}:${TAG} .

    - stage: Login to DockerHub
      steps:
        - withCredentials:
            - id: "dockerhub-cred"   # Jenkins credential ID
              usernameVariable: DOCKER_USER
              passwordVariable: DOCKER_PASS
        - sh: |
            echo "${DOCKER_PASS}" | docker login -u "${DOCKER_USER}" --password-stdin

    - stage: Push Docker Image
      steps:
        - sh: |
            echo "Pushing Docker image..."
            docker push ${DOCKER_IMAGE}:${TAG}

  post:
    always:
      - sh: docker logout

